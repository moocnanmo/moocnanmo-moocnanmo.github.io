<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>仿网易云音乐的小程序项目（粗糙版） | NanMooo</title><meta name="keywords" content="包子"><meta name="author" content="南漠"><meta name="copyright" content="南漠"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一个简简单单，用来上手小程序开发的音乐项目，利用跨站请求伪造 (CSRF), 伪造请求头 , 调用官方 API，获取真实网易云数据。">
<meta property="og:type" content="article">
<meta property="og:title" content="仿网易云音乐的小程序项目（粗糙版）">
<meta property="og:url" content="https://moocnanmo.github.io/2021/08/23/music/index.html">
<meta property="og:site_name" content="NanMooo">
<meta property="og:description" content="一个简简单单，用来上手小程序开发的音乐项目，利用跨站请求伪造 (CSRF), 伪造请求头 , 调用官方 API，获取真实网易云数据。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cn.bing.com/th?id=OHR.LittleBlueHeron_ZH-CN0892428603_1920x1080.jpg&rf=LaDigue_1920x1080.jpg">
<meta property="article:published_time" content="2021-08-23T10:02:35.000Z">
<meta property="article:modified_time" content="2021-11-18T05:12:42.273Z">
<meta property="article:author" content="南漠">
<meta property="article:tag" content="包子">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cn.bing.com/th?id=OHR.LittleBlueHeron_ZH-CN0892428603_1920x1080.jpg&rf=LaDigue_1920x1080.jpg"><link rel="shortcut icon" href="https://static01.imgkr.com/temp/dc895d541e0c44daa437a96073b9be70.png"><link rel="canonical" href="https://moocnanmo.github.io/2021/08/23/music/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '仿网易云音乐的小程序项目（粗糙版）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-18 13:12:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2722836_nxnmdzok33b.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://img-blog.csdnimg.cn/20210815175037722.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw iconfont icon-aixin"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw iconfont icon-shuji"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cn.bing.com/th?id=OHR.LittleBlueHeron_ZH-CN0892428603_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">NanMooo</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw iconfont icon-aixin"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw iconfont icon-shuji"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">仿网易云音乐的小程序项目（粗糙版）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-23T10:02:35.000Z" title="发表于 2021-08-23 18:02:35">2021-08-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-11-18T05:12:42.273Z" title="更新于 2021-11-18 13:12:42">2021-11-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E7%B1%BB/">项目类</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="仿网易云音乐的小程序项目（粗糙版）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><hr>
<p>通过github拉取下的后台服务器，根据接口文档，调用真实的网易云音乐数据，独立开发而成，收获很多 完成了 ：</p>
<ul>
<li>每日推荐的歌曲，歌单，视频页面，账号登陆的展示数据信息功能</li>
<li>歌曲和视频的播放切换，进度条实时跟进功能</li>
<li>视频区下拉刷新，模糊搜索歌曲功能</li>
</ul>
<p>开发完成后最大的感受就是一定要会看，会查微信小程序的官方API文档，出bug时首先检查语法是否正确（刚入门比较容易犯拼写错误），根据控制台给错的错误信息定位到相应文件，进行逻辑检查，注意后端返回的数据类型和和格式转换，看清接口文档明白后端要接收到的实际参数！！</p>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/">微信小程序官方文档</a></li>
<li> <a target="_blank" rel="noopener" href="https://neteasecloudmusicapi.vercel.app/#/?id=%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3">网易云接口调用文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13f4y1c7GW?spm_id_from=333.999.0.0">视频演示</a></li>
<li><a target="_blank" rel="noopener" href="https://gitee.com/nanmooo/nan_music.git">源码</a></li>
</ul>
</blockquote>
<p>页面预览：<br><img src="https://img-blog.csdnimg.cn/57f7e296b3e749688b229455ef807f72.png#pic_center" alt="在这里插入图片描述"></p>
<h1 id="功能介绍：获取诸如每日推荐的静态数据"><a href="#功能介绍：获取诸如每日推荐的静态数据" class="headerlink" title="功能介绍：获取诸如每日推荐的静态数据"></a>功能介绍：获取诸如每日推荐的静态数据</h1><p>诸如上述的每日轮播图，歌曲，歌单数据，获取方式十分简单，只需要参考调用文档，发送GET数据请求，解析收到的数据，将需要的信息展示到预先设好的图片插槽上即可。</p>
<p>在相应模块中的js文件里设置存放诸如每日轮播图，歌曲，歌单数据的数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">   <span class="comment">// 轮播图数据</span></span><br><span class="line">   <span class="attr">bannerList</span>: [],</span><br><span class="line">   <span class="comment">// 精心推荐歌单数据</span></span><br><span class="line">   <span class="attr">recommendList</span>: [],</span><br><span class="line">   <span class="comment">// 排行榜数据</span></span><br><span class="line">   <span class="attr">topList</span>: [],</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<p>然后在onLoad声明周期函数中，调用接口（注意文档所要求携带的参数），获取数据，将接口返回的数据通过setData方法保存至刚设置的数组里。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">onLoad: <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> bannerListData = <span class="keyword">await</span> request(<span class="string">&#x27;/banner&#x27;</span>, &#123; <span class="attr">type</span>: <span class="number">2</span> &#125;);</span><br><span class="line">   <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">     <span class="attr">bannerList</span>: bannerListData.banners</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 获取推荐歌单数据</span></span><br><span class="line">   <span class="keyword">let</span> recommendListData = <span class="keyword">await</span> request(<span class="string">&#x27;/personalized&#x27;</span>, &#123; <span class="attr">limit</span>: <span class="number">10</span> &#125;);</span><br><span class="line">   <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">     <span class="attr">recommendList</span>: recommendListData.result</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 获取排行榜的数据</span></span><br><span class="line">   <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">let</span> resultArr = [];</span><br><span class="line">   <span class="keyword">while</span> (index &lt; <span class="number">5</span>) &#123;</span><br><span class="line">     <span class="keyword">let</span> topListData = <span class="keyword">await</span> request(<span class="string">&#x27;/top/list&#x27;</span>, &#123; <span class="attr">idx</span>: index++ &#125;);</span><br><span class="line">     <span class="keyword">let</span> topListItem = &#123; <span class="attr">name</span>: topListData.playlist.name, <span class="attr">tracks</span>: topListData.playlist.tracks.slice(<span class="number">0</span>, <span class="number">3</span>) &#125;</span><br><span class="line">     resultArr.push(topListItem);</span><br><span class="line">     <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">       <span class="attr">topList</span>: resultArr</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<p>最后通过插槽展示出来，对于一些组件，可以添加官方给出的样式属性，让布局的交互效果更佳。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 轮播图区域 添加的属性：自动播放，切换时间间隔，下方小圆点 --&gt;</span><br><span class="line"> <span class="xml"><span class="tag">&lt;<span class="name">swiper</span> <span class="attr">autoplay</span> <span class="attr">interval</span>=<span class="string">&quot;4000&quot;</span> <span class="attr">class</span>=<span class="string">&quot;banners&quot;</span> <span class="attr">indicator-dots</span>=<span class="string">&quot;true&quot;</span> <span class="attr">indicator-color</span>=<span class="string">&quot;ivory&quot;</span> <span class="attr">indicator-active-color</span>=<span class="string">&quot;#d43c33&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;bannerList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;bannerId&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.pic&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>推荐歌曲部分大抵如此：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 推荐歌曲内容区 --&gt;</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;recommendScroll&quot;</span> <span class="attr">enable-flex</span> <span class="attr">scroll-x</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;scrollItem&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;recommendList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;recommendItem&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;recommendItem.picUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;recommendItem.name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>榜单部分：这里以item项进行滑动，每个item项宽度固定，只需调节宽度大小即可控制下一item项在页面的显示位置。<br><img src="https://img-blog.csdnimg.cn/bff57f5dc7f14bd4b4927ae3f990b8b7.png#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;swiper <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;topListSwiper&quot;</span> circular next-margin=<span class="string">&quot;110rpx&quot;</span>&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">class</span>=<span class="string">&quot;swiperBack&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;topList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;musicItem&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;item.tracks&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;musicItem&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;musicItem.al.picUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>&#123;&#123;index + 1&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;musicName&quot;</span>&gt;</span>&#123;&#123;musicItem.name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span></span><br><span class="line">&lt;/swiper&gt;</span><br></pre></td></tr></table></figure>

<h1 id="功能介绍：用户登陆"><a href="#功能介绍：用户登陆" class="headerlink" title="功能介绍：用户登陆"></a>功能介绍：用户登陆</h1><p>整个流程大致为：</p>
<ol>
<li><strong>前端验证</strong><ol>
<li>实时收集用户输入框数据（给账密绑定 id ,通过事件委托实时存储用户输入值）</li>
<li>验证账号密码是否合法（验证是否为空，格式正确，长度这几种情况）</li>
<li>验证通过就将账密发个请求给客户端，反之不通过则提示用户，不用发请求</li>
</ol>
</li>
<li><strong>后端验证</strong><ol>
<li>调用数据库验证用户是否存在</li>
<li>用户存在即验证密码是否正确，跟下一步一样，账密任何一个输错停止下一步，并告诉前端**错误</li>
<li>都正确就返回用户的数据给前端，并提示登陆成功</li>
</ol>
</li>
</ol>
<p>在实时存储和验证用户输入的账号密码时用的是同一个处理函数，怎么却分他们谁是谁呢，一般用id进行区别。这里有个重要知识点：<strong>事件委托</strong>。事件委托就是把子元素的事件让父元素完成，可通过<code>event.target</code> 找到触发的子元素，<code>currentTarget</code> 要求绑定事件的元素一定是触发事件的元素。</p>
<p>根据id存储信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> type = event.currentTarget.dataset.type;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      [type]: event.detail.value</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>点击登陆，携带账号密码信息触发后端验证（状态码为：200通过，400手机号错误，502密码错误），<code>wx.showToast</code> 显示登陆情况。成功后 <code>wx.setStorageSync</code> 将用户信息保存到本地（存储为json字符串格式类型），接着 <code>reLaunch</code> 重定向到某页面。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.setStorageSync(<span class="string">&#x27;userInfo&#x27;</span>, <span class="built_in">JSON</span>.stringify(result.profile))</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.reLaunch(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/personal/personal&#x27;</span></span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure>



<h1 id="功能介绍：视频播放"><a href="#功能介绍：视频播放" class="headerlink" title="功能介绍：视频播放"></a>功能介绍：视频播放</h1><p>网易获取视频需要用户登陆，用户登陆后把保存在本地的cookies取出。因为项目是做成上边导航栏，下边根据导航栏的索引 id 获取相关视频的开发模式，所以先获取导航栏的数据，和标签id分别以数组的形式存放在data数据中。<br><img src="https://img-blog.csdnimg.cn/af7f9e6f9ba64fcf9a3c0f39b58c6235.png#pic_center" alt="在这里插入图片描述"><br>获取导航栏数据方式跟先前拉取静态歌曲方式一样，均通过异步请求，来获取保存显示数据。不过这里有些不同，官方给的导航api中，标签id不能以数字开头，所以在显示时，均加以 ”scroll“ 字符串来满足要求，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 视频导航栏区域 --&gt;</span><br><span class="line"> <span class="xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">&quot;&#123;&#123;&#x27;scroll&#x27; + item.id&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navItem&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;videoGroupList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;navContent &#123;&#123;navId === item.id?&#x27;active&#x27;: &#x27;&#x27;&#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;changeNav&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;&#123;item.name&#125;&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>默认是第一个标签页视频，在点击第一个导航栏标签时，会将上面的字符串更改为数值类型，同时初始化该变迁下的存储视频数组，接着携带id触发获取视频调用函数。因为获取的视频里，单个视频没有唯一的id，所以我需要用map加工一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> getVideoList (navId) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!navId) &#123; <span class="comment">// 判断navId为空串的情况</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> videoListData = <span class="keyword">await</span> request(<span class="string">&#x27;/video/group&#x27;</span>, &#123; <span class="attr">id</span>: navId &#125;);</span><br><span class="line">  <span class="comment">// 关闭消息提示框</span></span><br><span class="line">  wx.hideLoading();</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> videoList = videoListData.datas.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    item.id = index++;</span><br><span class="line">    <span class="keyword">return</span> item;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    videoList,</span><br><span class="line">    <span class="attr">isTriggered</span>: <span class="literal">false</span> <span class="comment">// 关闭下拉刷新</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>到这里，视频获取就算完成额了，但是存在一些小问题。比如：同时播放多个视频。不能对视频进行上一次播放进度的跟踪。</p>
<h1 id="解决多个视频同时播放的问题-单例模式-和回到上个视频的播放进度"><a href="#解决多个视频同时播放的问题-单例模式-和回到上个视频的播放进度" class="headerlink" title="解决多个视频同时播放的问题(单例模式)和回到上个视频的播放进度"></a>解决多个视频同时播放的问题(单例模式)和回到上个视频的播放进度</h1><p>单例模式主要思想：在多个对象的场景下，通过一个变量接收，始终保持只有一个对象。那么用户在播放第二个视频时，我们需要通过上述map生成的唯一id判断这俩者不是同一个视频。</p>
<p>回到上个视频的播放进度的整体思路是：当我们每点击一个视频，存储该视频id,创建一个事件对象，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vid = event.currentTarget.id;</span><br><span class="line">   <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">     <span class="attr">videoId</span>: vid</span><br><span class="line">   &#125;)</span><br><span class="line"><span class="built_in">this</span>.videoContext = wx.createVideoContext(vid);</span><br></pre></td></tr></table></figure>
<p>查看他是否有播放记录，有就跳转到指定位置，没有就重头开始播放，然后实时将记录存储到刚创建的对象里的记录播放时长属性中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断当前的视频之前是否播放过，是否有播放记录, 如果有，跳转至指定的播放位置</span></span><br><span class="line">   <span class="keyword">let</span> &#123; videoUpdateTime &#125; = <span class="built_in">this</span>.data;</span><br><span class="line">   <span class="keyword">let</span> videoItem = videoUpdateTime.find(<span class="function"><span class="params">item</span> =&gt;</span> item.vid === vid);</span><br><span class="line">   <span class="keyword">if</span> (videoItem) &#123;</span><br><span class="line">     <span class="built_in">this</span>.videoContext.seek(videoItem.currentTime);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>关于播放时长的回调，播放前需判断播放时长是否有值，有就覆盖，在播放。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (videoItem) &#123; <span class="comment">// 之前有</span></span><br><span class="line">      videoItem.currentTime = event.detail.currentTime;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 之前没有</span></span><br><span class="line">      videoUpdateTime.push(videoTimeObj);</span><br><span class="line">      <span class="comment">// 有bug</span></span><br><span class="line">      <span class="built_in">this</span>.videoContext.play();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新videoUpdateTime的状态</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      videoUpdateTime</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>再有就是视频播放完后，需要善删掉视频播放状态</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">videoUpdateTime.splice(videoUpdateTime.findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item.vid === event.currentTarget.id), <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>下拉刷新，重新根据标签id发数据请求：上拉同理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handleRefresher () &#123;</span><br><span class="line">  <span class="comment">// 拿到数据后更改控制回弹属性是否为false即可</span></span><br><span class="line">  <span class="built_in">this</span>.getVideoList(<span class="built_in">this</span>.data.navId)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/b9b924284531442c9828b1128389e25d.png#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/2f69f3c00ed547e4ad375dc35acbdab5.png#pic_center" alt="在这里插入图片描述"></p>
<h1 id="功能介绍：音乐播放"><a href="#功能介绍：音乐播放" class="headerlink" title="功能介绍：音乐播放"></a>功能介绍：音乐播放</h1><p>界面预览：<br><img src="https://img-blog.csdnimg.cn/49829c0bd49e4222a07f1c5c9bb88b2a.png#pic_center" alt="在这里插入图片描述"></p>
<p>上面的日期采用 <code>date.getMonth()</code>  来定义进行实时显示，歌曲部分除付费歌曲外，都能通过接口调用获取。获取前需要验证用户是否登陆，通过先前登陆存储在本地的 <code>userInfo</code> 进行判断，没登陆即 <code>reLaunch</code> 到 login 页面。</p>
<p>这里稍提一下图像文本居中排布问题：<img src="https://img-blog.csdnimg.cn/42d52b1f36664e3b8dcbd41316c82525.png#pic_center" alt="在这里插入图片描述"><br>例如左侧图片，右侧文字需要做到居中对其、文本框内图标，与默认文字对其的情况。<br>根据子绝父相设置定位，接着父子元素都要设置 <code> flex</code> 弹性布局。每首歌曲是一个item项目，给图片设置宽高圆角底边距后（不用设浮动），右侧的文字也将看作是一个item，设置flex，和经典居中三命令执行。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.musicInfo</span> text&#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">  <span class="attribute">white-space</span>: normal;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最右侧图标利用绝对定位加边距调整即可；图标在搜索框中与文字齐平，图标可用 <code>vertical-align</code> 来设置center值。</p>
<p>居中排版问题说完，继续说音乐播放相关的事。</p>
<p><strong>音乐暂停播放键的显示</strong>：<br>对暂停还是播放的图标有俩个类名来取决显示那个图标，默认暂停（isplay：false），设置isPlay属性，没点一次通过 <code> setData（）</code> 对 isplay 进行取反更新操作。</p>
<p><strong>点击歌曲后跳转到播放页面获取详情信息</strong>：<br>点击歌曲后，需要携带所点击的歌曲的名称，id信息发送到播放页面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url: <span class="string">&#x27;/songPackage/pages/songDetail/songDetail?musicId=&#x27;</span> + song.id</span><br></pre></td></tr></table></figure>
<p>播放页面那边接受id发送请求获取该歌曲详情信息，其中durationTime为已播放时长。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取音乐功能详情的功能函数</span></span><br><span class="line"> <span class="keyword">async</span> getmusicInfo (musicId) &#123;</span><br><span class="line">   <span class="keyword">let</span> songData = <span class="keyword">await</span> request(<span class="string">&#x27;/song/detail&#x27;</span>, &#123; <span class="attr">ids</span>: musicId &#125;);</span><br><span class="line">   <span class="keyword">let</span> durationTime = moment(songData.songs[<span class="number">0</span>].dt).format(<span class="string">&#x27;mm:ss&#x27;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">     <span class="attr">song</span>: songData.songs[<span class="number">0</span>],</span><br><span class="line">     durationTime</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   wx.setNavigationBarTitle(&#123;</span><br><span class="line">     <span class="attr">title</span>: <span class="built_in">this</span>.data.song.name</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p><strong>播放或暂停音乐</strong>：<br>播放一首歌曲，需要知道该播放或暂停键的isPlay状态，音乐id，和该音乐的链接地址，音乐的链接地址可通过id向接口发送请求获取。</p>
<p><strong>小问题：当播放一首歌退出界面在点进来，会重头播放</strong>：<br>这时只需判断全局下的播放状态为真和id等于现在点的这首歌id就改变播放按钮状态即可，相同则不做播放处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (appInstance.globalData.isMusicPlay &amp;&amp; appInstance.globalData.musicId === musicId) &#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">isPlay</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>上一首或下一首切换</strong>：<br>给上一首或下一首分别绑定id值，但用统一处理事件，用户点击时连同id值一起传入，通过播放事件判断是上一首还是下一首，上一首的话就把当前歌曲id所在每日推荐的位置减一进行播放，反之+1。<br>点击的同时需要暂停当前播放曲目，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">handleSwitch (event) &#123;</span><br><span class="line">  <span class="keyword">let</span> type = event.currentTarget.id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 点以下一首后关闭当前音乐</span></span><br><span class="line">  <span class="built_in">this</span>.backgroundAudioManager.stop();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定于recommend的页面数据</span></span><br><span class="line">  PubSub.subscribe(<span class="string">&#x27;musicId&#x27;</span>, <span class="function">(<span class="params">msg, musicId</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拿到id后切换上下一首的歌曲详情信息，在调用是否播放函数</span></span><br><span class="line">    <span class="built_in">this</span>.getmusicInfo(musicId);</span><br><span class="line">    <span class="built_in">this</span>.musicControl(<span class="literal">true</span>, musicId);</span><br><span class="line">    <span class="comment">// 拿到id后在取消订阅，因为订阅依赖回调，会累加</span></span><br><span class="line">    PubSub.unsubscribe(<span class="string">&#x27;musicId&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布消息给recommend页面</span></span><br><span class="line">  PubSub.publish(<span class="string">&#x27;switchType&#x27;</span>, type)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>


<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PubSub.subscribe(<span class="string">&#x27;switchType&#x27;</span>, <span class="function">(<span class="params">msg, type</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123; recommendList, index &#125; = <span class="built_in">this</span>.data;</span><br><span class="line">      <span class="keyword">if</span> (type === <span class="string">&#x27;pre&#x27;</span>) &#123;</span><br><span class="line">        (index === <span class="number">0</span>) &amp;&amp; (index = recommendList.length)</span><br><span class="line">        index -= <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        (index === recommendList.length - <span class="number">1</span>) &amp;&amp; (index = -<span class="number">1</span>)</span><br><span class="line">        index += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        index</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">let</span> musicId = recommendList[index].id;</span><br><span class="line">      PubSub.publish(<span class="string">&#x27;musicId&#x27;</span>, musicId)</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h1 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h1><p><font style="background:#c0d6cb;color=green"   size=4>导航元素id类型转换问题：</font></p>
<p><code>let navId = event.currentTarget.id;</code>再点击导航栏获取元素id,想给他动态添加下标样式时，发现不成功，打印id发现拿到的元素是字符型的，而数据项中的id应该是数值，所以索引不到对应的item元素项。<br>解决方法：在更新数据时，把id*1转成数值型就好,或者位移运算符&gt;&gt;&gt; 0，或者在获取方式改为：<code>let navId = event.currentTarget.dataset.id</code></p>
<p><font style="background:#c0d6cb;color=green"   size=4>视频播放：</font><br>每点击一个视频就通过createVideoContext创建一个事件对象，在data中保存视频的数据列表，id，还有记录视频的播放时长videoUpdateTime。点击的时候，更新data中的视频id，接着监听进度条（videoUpdateTime以对象的形式存视频id和进度时间，如果查询到有这个视频id的记录，就seek，没有就push添加记录，然后play播放）判断视频是否播放过，来决定是否跳转（videoContext.seek）到相应进度条。</p>
<p><strong>下拉刷新：</strong><br>在handleRefresher生命周期中重新发起一个该导航栏下的数据请求即可。</p>
<p><strong>视频第一帧：</strong><br>给video加上<code>poster=&quot;&#123;&#123;item.data.coverUrl&#125;&#125;&quot;</code>属性，image部分加载，通过判断上一个视频播放的id和当前视频id是否一致决定加载的是视频还是图片。点击图片触发的播放回调函数跟视频的一致。</p>
<h1 id="做的优化"><a href="#做的优化" class="headerlink" title="做的优化"></a>做的优化</h1><blockquote>
<p>问题：点击歌曲的时候，不知道歌曲有无请求过，每次都是发送请求播放。</p>
</blockquote>
<p><strong>优化内容</strong>：将歌曲地址进行存储，播放时判断有无链接，有就通过<code>backgroundAudioManager.src= musicLink</code>调用进行播放，没有就重新发送，减少后台请求次数。</p>
<hr>
<p>还会继续开发，计划完善</p>
<ul>
<li>各类歌单功能：点击歌单，跳转到歌单列表，再点击歌曲，进行播放</li>
<li>显示歌曲的歌词，应该有现成的库可直接调用</li>
<li>显示歌曲评论，完成歌曲的交互功能</li>
<li>根据搜索名称得到单曲，歌单，mv之类的数据</li>
</ul>
<p>呃呃呃，，，差不多这样</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">南漠</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://moocnanmo.github.io/2021/08/23/music/">https://moocnanmo.github.io/2021/08/23/music/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://moocnanmo.github.io" target="_blank">NanMooo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cn.bing.com/th?id=OHR.LittleBlueHeron_ZH-CN0892428603_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/08/24/html/"><img class="prev-cover" src="https://cn.bing.com/th?id=OHR.GiantManta_ZH-CN0594951444_1920x1080.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HTML&amp;CSS的一些知识点</div></div></a></div><div class="next-post pull-right"><a href="/2021/08/20/blog/"><img class="next-cover" src="https://img-blog.csdnimg.cn/20210814202145968.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">记录下使用hexo框架搭建博客和踩过的坑</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D%EF%BC%9A%E8%8E%B7%E5%8F%96%E8%AF%B8%E5%A6%82%E6%AF%8F%E6%97%A5%E6%8E%A8%E8%8D%90%E7%9A%84%E9%9D%99%E6%80%81%E6%95%B0%E6%8D%AE"><span class="toc-number">2.</span> <span class="toc-text">功能介绍：获取诸如每日推荐的静态数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D%EF%BC%9A%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86"><span class="toc-number">3.</span> <span class="toc-text">功能介绍：用户登陆</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D%EF%BC%9A%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE"><span class="toc-number">4.</span> <span class="toc-text">功能介绍：视频播放</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%A4%9A%E4%B8%AA%E8%A7%86%E9%A2%91%E5%90%8C%E6%97%B6%E6%92%AD%E6%94%BE%E7%9A%84%E9%97%AE%E9%A2%98-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-%E5%92%8C%E5%9B%9E%E5%88%B0%E4%B8%8A%E4%B8%AA%E8%A7%86%E9%A2%91%E7%9A%84%E6%92%AD%E6%94%BE%E8%BF%9B%E5%BA%A6"><span class="toc-number">5.</span> <span class="toc-text">解决多个视频同时播放的问题(单例模式)和回到上个视频的播放进度</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D%EF%BC%9A%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE"><span class="toc-number">6.</span> <span class="toc-text">功能介绍：音乐播放</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">7.</span> <span class="toc-text">遇到的问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%81%9A%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">8.</span> <span class="toc-text">做的优化</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 南漠</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="好,好,学,习,为,国,效,力" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>